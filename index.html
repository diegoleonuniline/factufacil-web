<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>FacturaFÃ¡cil - Portal de FacturaciÃ³n</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
  
  <!-- OVERLAY DE CARGA -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p id="loadingText">Procesando...</p>
    </div>
  </div>

  <!-- MODAL IMAGEN -->
  <div id="modalImagen" class="modal hidden" onclick="cerrarModalImagen(event)">
    <button class="modal-close" onclick="event.stopPropagation(); cerrarModalImagen(event);">âœ•</button>
    <div class="modal-content" onclick="event.stopPropagation();">
      <img id="modalImg" src="">
    </div>
  </div>

  <!-- MODAL DETALLE SOLICITUD (solo para empresa) -->
  <div id="modalDetalle" class="modal hidden">
    <div class="modal-detalle-content">
      <button class="modal-close" onclick="cerrarModalDetalle()">âœ•</button>
      <h2 class="modal-detalle-title">Detalle de Solicitud</h2>
      <div class="modal-detalle-grid">
        <div class="modal-detalle-section">
          <h3>ğŸ“‹ InformaciÃ³n</h3>
          <div id="detalleInfo" class="detalle-info"></div>
        </div>
        <div class="modal-detalle-section detalle-imagen">
          <h3>ğŸ“· Ticket</h3>
          <div id="detalleTicket"></div>
        </div>
      </div>
      <div class="modal-detalle-section detalle-csf">
        <h3>ğŸ“„ CSF</h3>
        <div id="detalleCSF"></div>
      </div>
      <div class="modal-detalle-actions" id="detalleAcciones"></div>
    </div>
  </div>

  <!-- MODAL DETALLE CLIENTE (para dashboard) -->
  <div id="modalDetalleCliente" class="modal hidden">
    <div class="modal-detalle-content">
      <button class="modal-close" onclick="cerrarModalDetalleCliente()">âœ•</button>
      <h2 class="modal-detalle-title">Detalle de Solicitud</h2>
      <div id="detalleClienteBody"></div>
    </div>
  </div>

  <!-- MODAL CREAR/EDITAR USUARIO EMPRESA -->
  <div id="modalUsuario" class="modal hidden">
    <div class="modal-form-content">
      <button class="modal-close" onclick="cerrarModalUsuario()">âœ•</button>
      <h2 class="modal-detalle-title" id="modalUsuarioTitulo">Nuevo Usuario</h2>
      <form onsubmit="event.preventDefault(); guardarUsuarioEmpresa();">
        <input type="hidden" id="usuarioEditId">
        <div class="form-group-compact">
          <label>Usuario de Acceso *</label>
          <input type="text" id="usuarioNombreAcceso" class="input" placeholder="usuario123" required>
        </div>
        <div class="form-group-compact">
          <label>Nombre Completo *</label>
          <input type="text" id="usuarioNombreCompleto" class="input" placeholder="Juan PÃ©rez" required>
        </div>
        <div class="form-group-compact">
          <label>Email</label>
          <input type="email" id="usuarioEmail" class="input" placeholder="usuario@correo.com">
        </div>
        <div class="form-group-compact">
          <label>ContraseÃ±a *</label>
          <input type="password" id="usuarioPassword" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
          <small style="color: var(--gray-500); font-size: 12px;">Al editar, dejar vacÃ­o para mantener contraseÃ±a actual</small>
        </div>
        <div class="form-group-compact">
          <label>Permisos *</label>
          <select id="usuarioPermisos" class="input" required>
            <option value="lectura">Solo Ver</option>
            <option value="gestionar">Gestionar</option>
          </select>
        </div>
        <div class="form-group-compact">
          <label>Administrador *</label>
          <select id="usuarioAdmin" class="input" required>
            <option value="No">No</option>
            <option value="Si">SÃ­</option>
          </select>
        </div>
        <div class="form-group-compact">
          <label>Estado *</label>
          <select id="usuarioEstado" class="input" required>
            <option value="Activo">Activo</option>
            <option value="Inactivo">Inactivo</option>
          </select>
        </div>
        <div class="modal-form-actions">
          <button type="button" class="btn btn-secondary" onclick="cerrarModalUsuario()">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar Usuario</button>
        </div>
      </form>
    </div>
  </div>

  <!-- MODAL RAZÃ“N SOCIAL -->
  <div id="modalRazon" class="modal hidden">
    <div class="modal-form-content">
      <button class="modal-close" onclick="cerrarModalRazon()">âœ•</button>
      <h2 class="modal-detalle-title" id="modalRazonTitulo">Nueva RazÃ³n Social</h2>
      <form onsubmit="event.preventDefault(); guardarRazonSocial();">
        <input type="hidden" id="razonEditId">
        <div class="form-row">
          <div class="form-group-compact">
            <label>RFC *</label>
            <input type="text" id="razonRfc" class="input input-upper" maxlength="13" required>
          </div>
          <div class="form-group-compact">
            <label>C.P. *</label>
            <input type="text" id="razonCp" class="input" maxlength="5" required>
          </div>
        </div>
        <div class="form-group-compact">
          <label>RazÃ³n Social *</label>
          <input type="text" id="razonNombre" class="input" required>
        </div>
        <div class="form-group-compact">
          <label>RÃ©gimen Fiscal *</label>
          <select id="razonRegimen" class="input" required>
            <option value="">Selecciona...</option>
          </select>
        </div>
        <div class="form-group-compact">
          <label>Uso de CFDI *</label>
          <select id="razonUsoCfdi" class="input" required>
            <option value="">Selecciona...</option>
          </select>
        </div>
        <div class="form-group-compact">
          <label>ğŸ“„ Constancia de SituaciÃ³n Fiscal (CSF)</label>
          <div class="file-box-compact" onclick="document.getElementById('razonCsfFile').click()">
            <input type="file" id="razonCsfFile" accept="image/*,application/pdf" onchange="previewRazonCSF(this)" style="display:none">
            <div id="razonCsfText" class="file-placeholder-compact">ğŸ“„ Subir CSF (opcional)</div>
          </div>
        </div>
        <div class="modal-form-actions">
          <button type="button" class="btn btn-secondary" onclick="cerrarModalRazon()">Cancelar</button>
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast" class="toast"></div>

  <!-- OVERLAY SIDEBAR MOBILE -->
  <div id="sidebarOverlay" class="sidebar-overlay hidden" onclick="cerrarMenuMobile()"></div>

  <!-- APP CONTAINER -->
  <div class="app-container">
    
    <!-- SIDEBAR -->
    <aside id="sidebar" class="sidebar hidden">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">ğŸ§¾</div>
          <div>
            <div class="logo-title">FacturaFÃ¡cil</div>
            <div class="logo-subtitle">Portal de FacturaciÃ³n</div>
          </div>
        </div>
      </div>

      <div class="sidebar-user">
        <div class="sidebar-avatar" id="sidebarAvatar">U</div>
        <div>
          <div class="sidebar-user-name" id="sidebarUserName">Usuario</div>
          <div class="sidebar-user-type" id="sidebarUserType">Cliente</div>
        </div>
      </div>

      <nav class="sidebar-nav" id="sidebarNav">
        <button class="nav-item active" data-view="dashboard">
          <span class="nav-icon">ğŸ </span>
          Inicio
        </button>
        <button class="nav-item" data-view="solicitar">
          <span class="nav-icon">ğŸ“</span>
          Nueva Solicitud
        </button>
        <button class="nav-item" data-view="historial">
          <span class="nav-icon">ğŸ“‹</span>
          Mis Solicitudes
        </button>
        <button class="nav-item" data-view="perfil">
          <span class="nav-icon">ğŸ‘¤</span>
          Mi Perfil
        </button>
      </nav>

      <nav class="sidebar-nav" id="sidebarNavEmpresa" style="display:none;">
        <button class="nav-item active" data-view="solicitudes-empresa">
          <span class="nav-icon">ğŸ“‹</span>
          Solicitudes
        </button>
        <button class="nav-item" data-view="usuarios-empresa">
          <span class="nav-icon">ğŸ‘¥</span>
          Usuarios
        </button>
        <button class="nav-item" data-view="qr-empresa">
          <span class="nav-icon">ğŸ“±</span>
          Mi QR
        </button>
      </nav>

      <div class="sidebar-footer">
        <button class="btn-logout-sidebar" onclick="logout()">
          <span>ğŸšª</span>
          Cerrar SesiÃ³n
        </button>
      </div>
    </aside>

    <!-- MOBILE HEADER -->
    <header id="mobileHeader" class="mobile-header hidden">
      <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
      <div class="mobile-header-title">FacturaFÃ¡cil</div>
      <button class="mobile-logout-btn" onclick="logout()">ğŸšª</button>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main-content">

      <!-- LOGIN SECTION -->
      <section id="loginSection" class="login-wrapper">
        <div class="hero-banner">
          <div class="hero-banner-content">
            <div class="hero-banner-icon">ğŸ§¾</div>
            <h1 class="hero-banner-title">Solicita tu factura en segundos</h1>
            <p class="hero-banner-subtitle">Sin complicaciones, sin papeles, 100% digital</p>
            <div class="hero-banner-features">
              <div class="hero-banner-feature"><span>âš¡</span><span>RÃ¡pido</span></div>
              <div class="hero-banner-feature"><span>ğŸ“±</span><span>Desde tu celular</span></div>
              <div class="hero-banner-feature"><span>âœ…</span><span>100% seguro</span></div>
            </div>
          </div>
        </div>

        <div class="auth-container-new">
          <div class="auth-card">
            <div class="auth-header">
              <h1>Comienza ahora</h1>
              <p>Elige cÃ³mo deseas continuar</p>
            </div>

            <div class="tipo-toggle-triple">
              <button id="btnTipoInvitado" class="tipo-btn active" onclick="selectTipoLogin('invitado')">
                <span>ğŸ‘¤</span>Invitado
              </button>
              <button id="btnTipoCliente" class="tipo-btn" onclick="selectTipoLogin('cliente')">
                <span>ğŸ‘¨â€ğŸ’¼</span>Cliente
              </button>
              <button id="btnTipoEmpresa" class="tipo-btn" onclick="selectTipoLogin('empresa')">
                <span>ğŸ¢</span>Empresa
              </button>
            </div>

            <div id="invitadoInfo">
              <p style="text-align: center; color: var(--gray-600); margin-bottom: 20px;">
                ContinÃºa sin cuenta para hacer tu solicitud
              </p>
              <button class="btn btn-primary btn-block btn-lg" onclick="continuarInvitado()">
                Continuar como Invitado
              </button>
            </div>

            <div id="loginFormContainer" class="hidden">
              <form onsubmit="event.preventDefault(); login();">
                <div class="form-group">
                  <label id="labelLoginUser">Correo electrÃ³nico</label>
                  <input type="text" id="loginUser" class="input" placeholder="tu@correo.com" required>
                </div>
                <div class="form-group">
                  <label>ContraseÃ±a</label>
                  <input type="password" id="loginPass" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block btn-lg">Iniciar SesiÃ³n</button>
              </form>
              <p id="linkRegistro" class="text-center mt-3">
                Â¿No tienes cuenta? <a href="#" onclick="event.preventDefault(); showRegistro();">RegÃ­strate</a>
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- REGISTRO SECTION -->
      <section id="registroSection" class="hidden">
        <div class="auth-container">
          <div class="auth-card">
            <button class="btn-back" onclick="showLogin()">â†</button>
            <div class="auth-header">
              <div class="auth-logo">ğŸ“</div>
              <h1>Crear Cuenta</h1>
              <p>RegÃ­strate para gestionar tus facturas</p>
            </div>
            <form onsubmit="event.preventDefault(); registrar();">
              <div class="form-group">
                <label>Nombre Completo *</label>
                <input type="text" id="regNombre" class="input" placeholder="Juan PÃ©rez" required>
              </div>
              <div class="form-group">
                <label>Correo ElectrÃ³nico *</label>
                <input type="email" id="regEmail" class="input" placeholder="tu@correo.com" required>
              </div>
              <div class="form-group">
                <label>ContraseÃ±a *</label>
                <input type="password" id="regPass" class="input" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label>RFC *</label>
                  <input type="text" id="regRfc" class="input input-upper" placeholder="XAXX010101000" maxlength="13" required>
                </div>
                <div class="form-group">
                  <label>C.P. *</label>
                  <input type="text" id="regCp" class="input" placeholder="44100" maxlength="5" required>
                </div>
              </div>
              <div class="form-group">
                <label>RazÃ³n Social *</label>
                <input type="text" id="regRazon" class="input" placeholder="Mi Empresa SA de CV" required>
              </div>
              <div class="form-group">
                <label>RÃ©gimen Fiscal *</label>
                <select id="regRegimen" class="input" required><option value="">Selecciona...</option></select>
              </div>
              <div class="form-group">
                <label>Uso de CFDI *</label>
                <select id="regUsoCfdi" class="input" required><option value="">Selecciona...</option></select>
              </div>
              <div class="form-group">
                <label>ğŸ“„ Constancia de SituaciÃ³n Fiscal (CSF)</label>
                <div class="file-box-compact" onclick="document.getElementById('regCsfFile').click()">
                  <input type="file" id="regCsfFile" accept="image/*,application/pdf" onchange="previewRegCSF(this)" style="display:none">
                  <div id="regCsfText" class="file-placeholder-compact">ğŸ“„ Subir CSF (opcional)</div>
                </div>
              </div>
              <button type="submit" class="btn btn-success btn-block btn-lg">Crear Cuenta</button>
            </form>
          </div>
        </div>
      </section>

      <!-- PANEL CLIENTE -->
      <div id="panelCliente" class="hidden">
        
        <!-- DASHBOARD -->
        <div id="view-dashboard" class="content-view active">
          <div class="page-header-compact">
            <h1 class="page-title-compact">ğŸ‘‹ Hola, <span id="dashboardNombre">Usuario</span></h1>
          </div>

          <div class="dashboard-banner">
            <div class="dashboard-banner-content">
              <h2>Â¿QuÃ© deseas hacer?</h2>
              <p>Selecciona una opciÃ³n para continuar</p>
            </div>
          </div>

          <div class="dashboard-actions-grid">
            <button class="dashboard-action-card primary" onclick="navegarA('solicitar')">
              <div class="action-icon">ğŸ“</div>
              <div class="action-content">
                <h3>Nueva Solicitud</h3>
                <p>Solicita una factura de tu compra</p>
              </div>
              <div class="action-arrow">â†’</div>
            </button>
            
            <button class="dashboard-action-card" onclick="navegarA('historial')">
              <div class="action-icon">ğŸ“‹</div>
              <div class="action-content">
                <h3>Mis Solicitudes</h3>
                <p>Revisa el estado de tus facturas</p>
              </div>
              <div class="action-arrow">â†’</div>
            </button>
            
            <button class="dashboard-action-card" onclick="navegarA('perfil')">
              <div class="action-icon">ğŸ‘¤</div>
              <div class="action-content">
                <h3>Mi Perfil</h3>
                <p>Gestiona tus datos fiscales</p>
              </div>
              <div class="action-arrow">â†’</div>
            </button>
          </div>

          <div class="card-compact">
            <div class="card-header-compact">
              <span class="card-icon">ğŸ“Š</span>
              <span class="card-title-text">Resumen</span>
            </div>
            <div class="dashboard-stats-mini">
              <div class="stat-mini">
                <span class="stat-mini-number" id="statTotal">0</span>
                <span class="stat-mini-label">Total</span>
              </div>
              <div class="stat-mini pending">
                <span class="stat-mini-number" id="statPendientes">0</span>
                <span class="stat-mini-label">Pendientes</span>
              </div>
              <div class="stat-mini done">
                <span class="stat-mini-number" id="statFacturadas">0</span>
                <span class="stat-mini-label">Facturadas</span>
              </div>
              <div class="stat-mini rejected">
                <span class="stat-mini-number" id="statRechazadas">0</span>
                <span class="stat-mini-label">Rechazadas</span>
              </div>
            </div>
          </div>

          <div class="card-compact">
            <div class="card-header-compact">
              <span class="card-icon">ğŸ•</span>
              <span class="card-title-text">Ãšltimas Solicitudes</span>
            </div>
            <div id="ultimasSolicitudes"></div>
          </div>
        </div>

        <!-- SOLICITAR -->
        <div id="view-solicitar" class="content-view">
          <div class="page-header-compact">
            <h1 class="page-title-compact">ğŸ“ Nueva Solicitud</h1>
          </div>

          <div class="card-compact">
            <div class="card-header-compact">
              <span class="card-icon">ğŸª</span>
              <span class="card-title-text">Tienda</span>
            </div>
            <select id="empresaId" class="input" required>
              <option value="">Selecciona una tienda...</option>
            </select>
          </div>

          <div id="selectorRazon" class="card-compact hidden">
            <div class="card-header-compact">
              <span class="card-icon">ğŸ¢</span>
              <span class="card-title-text">RazÃ³n Social</span>
            </div>
            <select id="solRazonSelect" class="input" onchange="cargarDatosRazon(this.value)">
              <option value="">Selecciona o ingresa nueva...</option>
            </select>
          </div>

          <div class="content-grid">
            <div class="card-compact">
              <div class="card-header-compact">
                <span class="card-icon">ğŸ’³</span>
                <span class="card-title-text">Datos Fiscales</span>
              </div>

              <div class="form-group-compact">
                <label>RFC *</label>
                <div style="position: relative;">
                  <input type="text" id="solRfc" class="input input-upper" placeholder="XAXX010101000" maxlength="13" required oninput="buscarDatosPorRFC(this.value)">
                  <div id="rfcLoader" class="rfc-loader hidden">
                    <div class="rfc-spinner"></div>
                  </div>
                </div>
                <div id="rfcStatus" class="rfc-status hidden"></div>
              </div>

              <div class="form-group-compact">
                <label>RazÃ³n Social *</label>
                <input type="text" id="solRazon" class="input" placeholder="Mi Empresa SA de CV" required>
              </div>

              <div class="form-row">
                <div class="form-group-compact">
                  <label>RÃ©gimen *</label>
                  <select id="solRegimen" class="input" required><option value="">Selecciona...</option></select>
                </div>
                <div class="form-group-compact">
                  <label>C.P. *</label>
                  <input type="text" id="solCp" class="input" placeholder="44100" maxlength="5" required>
                </div>
              </div>

              <div class="form-group-compact">
                <label>Uso CFDI *</label>
                <select id="solUsoCfdi" class="input" required><option value="">Selecciona...</option></select>
              </div>

              <div class="form-group-compact">
                <label>Email *</label>
                <input type="email" id="solEmail" class="input" placeholder="tu@correo.com" required>
              </div>

              <div class="form-group-compact">
                <label>CC</label>
                <input type="email" id="solCC" class="input" placeholder="copia@correo.com">
              </div>
            </div>

            <div class="card-compact">
              <div class="card-header-compact">
                <span class="card-icon">ğŸ§¾</span>
                <span class="card-title-text">Datos de Compra</span>
              </div>

              <div class="form-group-compact">
                <label>Monto Total</label>
                <input type="number" id="solMonto" class="input" placeholder="1000.00" step="0.01">
              </div>

              <div class="form-group-compact">
                <label>Folio</label>
                <input type="text" id="solFolio" class="input" placeholder="ABC123">
              </div>

              <div class="form-group-compact">
                <label>Notas</label>
                <textarea id="solNotas" class="input" placeholder="InformaciÃ³n adicional..." rows="3"></textarea>
              </div>

              <div class="form-group-compact">
                <label>ğŸ“· Ticket *</label>
                <div class="file-box-compact" onclick="document.getElementById('ticketFile').click()">
                  <input type="file" id="ticketFile" accept="image/*" onchange="previewTicket(this)" style="display:none">
                  <div id="ticketUploadText" class="file-placeholder-compact"><span>ğŸ“· Subir ticket</span></div>
                  <img id="ticketPreview" class="file-preview-compact hidden" alt="Preview">
                </div>
              </div>

              <div class="form-group-compact">
                <label>ğŸ“„ CSF</label>
                <div class="file-box-compact" onclick="document.getElementById('csfFile').click()">
                  <input type="file" id="csfFile" accept="image/*,application/pdf" onchange="previewCSF(this)" style="display:none">
                  <div id="csfUploadText" class="file-placeholder-compact"><span>ğŸ“„ Subir CSF</span></div>
                  <div id="csfPreview" class="file-preview-name-compact hidden"></div>
                </div>
                <div id="csfFromRazon" class="csf-from-razon hidden">
                  <small>âœ… Se usarÃ¡ la CSF guardada en tu perfil</small>
                </div>
              </div>
            </div>
          </div>

          <button class="btn btn-success btn-block" onclick="enviarSolicitud()">âœ… Enviar Solicitud</button>
        </div>

        <!-- HISTORIAL -->
        <div id="view-historial" class="content-view">
          <div class="page-header-compact">
            <h1 class="page-title-compact">ğŸ“‹ Mis Solicitudes</h1>
          </div>
          <div class="card-compact">
            <div id="historialList"></div>
          </div>
        </div>

        <!-- PANEL LATERAL DETALLE -->
        <div id="detalleSolicitudPanel" class="detalle-panel hidden">
          <div class="detalle-panel-header">
            <button class="btn-cerrar-panel" onclick="cerrarPanelDetalle()">â†</button>
            <h3>Detalle de Solicitud</h3>
          </div>
          
          <div class="detalle-panel-content">
            <div class="detalle-section">
              <h4>ğŸ“‹ InformaciÃ³n General</h4>
              <div id="detallePanelInfo"></div>
            </div>
            
            <div class="detalle-section">
              <h4>ğŸ’³ Datos Fiscales</h4>
              <div id="detallePanelFiscal"></div>
            </div>
            
            <div class="detalle-section">
              <h4>ğŸ“· Ticket</h4>
              <div id="detallePanelTicket"></div>
            </div>
            
            <div class="detalle-section">
              <h4>ğŸ“„ CSF</h4>
              <div id="detallePanelCSF"></div>
            </div>
          </div>
        </div>

        <!-- PERFIL -->
        <div id="view-perfil" class="content-view">
          <div class="page-header-compact">
            <h1 class="page-title-compact">ğŸ‘¤ Mi Perfil</h1>
          </div>

          <div class="card-compact">
            <div class="card-header-compact">
              <span class="card-icon">ğŸ‘¤</span>
              <span class="card-title-text">InformaciÃ³n Personal</span>
            </div>
            <div class="form-group-compact">
              <label>Nombre</label>
              <input type="text" id="perfilNombre" class="input" placeholder="Tu nombre">
            </div>
            <div class="form-group-compact">
              <label>Email</label>
              <input type="email" id="perfilEmail" class="input" disabled>
            </div>
            <div class="form-group-compact">
              <label>Nueva ContraseÃ±a</label>
              <input type="password" id="perfilPass" class="input" placeholder="Dejar vacÃ­o para no cambiar">
            </div>
            <div class="form-group-compact">
              <label>ğŸ“„ Constancia de SituaciÃ³n Fiscal (General)</label>
              <div class="file-box-compact" onclick="document.getElementById('perfilCsfFile').click()">
                <input type="file" id="perfilCsfFile" accept="image/*,application/pdf" onchange="previewPerfilCSF(this)" style="display:none">
                <div id="perfilCsfText" class="file-placeholder-compact">ğŸ“„ Subir CSF</div>
              </div>
              <div id="perfilCsfActual" class="hidden">
                <small>âœ… CSF guardada - <a href="#" onclick="verCSFPerfil()">Ver</a></small>
              </div>
            </div>
            <button class="btn btn-primary" onclick="actualizarPerfil()">Guardar InformaciÃ³n Personal</button>
          </div>

          <div class="card-compact">
            <div class="card-header-compact">
              <span class="card-icon">ğŸ¢</span>
              <span class="card-title-text">Mis Razones Sociales</span>
              <button class="btn btn-sm btn-primary" onclick="abrirModalNuevaRazon()" style="margin-left: auto;">â• Agregar</button>
            </div>
            <div id="listaRazones"></div>
          </div>
        </div>
      </div>

      <!-- PANEL EMPRESA -->
      <div id="panelEmpresa" class="hidden">
        
        <!-- SOLICITUDES EMPRESA -->
        <div id="view-solicitudes-empresa" class="content-view active">
          <div class="page-header-compact">
            <h1 class="page-title-compact">ğŸ“‹ <span id="empresaNombre"></span></h1>
          </div>

          <div class="card-compact filter-card">
            <div class="card-header-compact">
              <span class="card-icon">ğŸ”</span>
              <span class="card-title-text">Filtros</span>
            </div>
            <div class="filter-row">
              <div class="form-group-compact">
                <label>Estado</label>
                <select id="filtroEstado" class="input" onchange="aplicarFiltros()">
                  <option value="">Todos</option>
                  <option value="Pendiente">Pendiente</option>
                  <option value="Facturado">Facturado</option>
                  <option value="Rechazado">Rechazado</option>
                </select>
              </div>
              <div class="form-group-compact">
                <label>Desde</label>
                <input type="date" id="filtroDesde" class="input" onchange="aplicarFiltros()">
              </div>
              <div class="form-group-compact">
                <label>Hasta</label>
                <input type="date" id="filtroHasta" class="input" onchange="aplicarFiltros()">
              </div>
              <div class="form-group-compact">
                <label>Buscar</label>
                <input type="text" id="filtroBuscar" class="input" placeholder="RFC, Email..." oninput="aplicarFiltros()">
              </div>
            </div>
          </div>

          <div class="card-compact">
            <div class="table-container">
              <table class="tabla-solicitudes">
                <thead>
                  <tr>
                    <th>Fecha</th>
                    <th>Cliente</th>
                    <th>RFC</th>
                    <th>Monto</th>
                    <th>Ticket</th>
                    <th>CSF</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="solicitudesEmpresa">
                  <tr><td colspan="8"><div class="loader"></div></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- USUARIOS EMPRESA -->
        <div id="view-usuarios-empresa" class="content-view">
          <div class="page-header-compact">
            <h1 class="page-title-compact">ğŸ‘¥ Usuarios</h1>
            <button class="btn btn-primary" onclick="abrirModalNuevoUsuario()">â• Nuevo Usuario</button>
          </div>

          <div class="card-compact">
            <div class="table-container">
              <table class="tabla-usuarios">
                <thead>
                  <tr>
                    <th>Usuario</th>
                    <th>Nombre</th>
                    <th>Email</th>
                    <th>Permisos</th>
                    <th>Admin</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody id="usuariosEmpresa">
                  <tr><td colspan="7"><div class="loader"></div></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- QR EMPRESA -->
        <div id="view-qr-empresa" class="content-view">
          <div class="page-header-compact">
            <h1 class="page-title-compact">ğŸ“± Mi CÃ³digo QR</h1>
          </div>
          <div class="card-compact" style="text-align: center;">
            <h3 style="margin-bottom: 16px; font-size: 18px; color: var(--gray-900);">CÃ³digo QR para Solicitar Facturas</h3>
            <p style="color: var(--gray-600); margin-bottom: 24px; font-size: 14px;">Tus clientes pueden escanear este cÃ³digo</p>
            <img id="qrEmpresaImage" src="" alt="QR Code" style="max-width: 350px; width: 100%; margin: 0 auto 24px; border-radius: 12px; box-shadow: var(--shadow-lg);">
            <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
              <a id="qrEmpresaDownload" href="" download="qr-facturacion.png" class="btn btn-primary">ğŸ“¥ Descargar QR</a>
              <button class="btn btn-success" onclick="compartirQR()">ğŸ“¤ Compartir</button>
            </div>
          </div>
        </div>
      </div>

    </main>

    <!-- BOTTOM NAV -->
    <nav id="bottomNav" class="bottom-nav hidden">
      <button class="bottom-nav-item active" data-view="dashboard" onclick="handleBottomNav(this)">
        <span class="bottom-nav-icon">ğŸ </span>
        <span class="bottom-nav-label">Inicio</span>
      </button>
      <button class="bottom-nav-item" data-view="solicitar" onclick="handleBottomNav(this)">
        <span class="bottom-nav-icon">ğŸ“</span>
        <span class="bottom-nav-label">Solicitar</span>
      </button>
      <button class="bottom-nav-item" data-view="historial" onclick="handleBottomNav(this)">
        <span class="bottom-nav-icon">ğŸ“‹</span>
        <span class="bottom-nav-label">Historial</span>
      </button>
      <button class="bottom-nav-item" data-view="perfil" onclick="handleBottomNav(this)">
        <span class="bottom-nav-icon">ğŸ‘¤</span>
        <span class="bottom-nav-label">Perfil</span>
      </button>
    </nav>

  </div>

  <script src="app.js"></script>
</body>
</html>
